load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "db",
    srcs = [
        "backup.go",
        "batch.go",
        "buffered_random_reader.go",
        "classification.go",
        "crud.go",
        "index.go",
        "index_sharding_backward_compatibility.go",
        "init.go",
        "metrics.go",
        "migrator.go",
        "nodes.go",
        "replication.go",
        "repo.go",
        "resource_use.go",
        "search.go",
        "shard.go",
        "shard_aggregate.go",
        "shard_backup.go",
        "shard_dimension_tracking.go",
        "shard_geo_props.go",
        "shard_init_properties.go",
        "shard_read.go",
        "shard_replication.go",
        "shard_resource_use.go",
        "shard_status.go",
        "shard_version.go",
        "shard_write_batch_delete.go",
        "shard_write_batch_objects.go",
        "shard_write_batch_references.go",
        "shard_write_delete.go",
        "shard_write_inverted.go",
        "shard_write_inverted_lsm.go",
        "shard_write_inverted_lsm_delete.go",
        "shard_write_merge.go",
        "shard_write_put.go",
        "sortby_distances.go",
        "sortby_scores.go",
        "vector_index.go",
    ],
    importpath = "github.com/marcussorealheis/weaviate/adapters/repos/db",
    visibility = ["//visibility:public"],
    deps = [
        "@com_github_go_openapi_strfmt//:go_default_library",
        "@com_github_google_uuid//:go_default_library",
        "@com_github_pkg_errors//:go_default_library",
        "@com_github_prometheus_client_golang//prometheus:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/aggregator:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/docid:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/helpers:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/indexcounter:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/inverted:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/inverted/stopwords:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/lsmkv:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/propertyspecific:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/refcache:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/sorter:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/vector/geo:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/vector/hnsw:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/vector/hnsw/distancer:go_default_library",
        "@com_github_semi_technologies_weaviate//adapters/repos/db/vector/noop:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/additional:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/aggregation:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/backup:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/errorcompounder:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/errors:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/filters:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/models:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/multi:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/schema:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/schema/crossref:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/search:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/searchparams:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/storagestate:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/storobj:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/vectorindex/hnsw:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/classification:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/config:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/memwatch:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/monitoring:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/objects:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/replica:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/schema:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/sharding:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/traverser:go_default_library",
        "@com_github_semi_technologies_weaviate//usecases/vectorizer:go_default_library",
        "@com_github_sirupsen_logrus//:go_default_library",
        "@org_golang_x_sync//errgroup:go_default_library",
    ],
)

go_test(
    name = "db_test",
    srcs = [
        "buffered_random_reader_test.go",
        "sortby_scores_test.go",
    ],
    embed = [":db"],
    deps = [
        "@com_github_go_openapi_strfmt//:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/models:go_default_library",
        "@com_github_semi_technologies_weaviate//entities/storobj:go_default_library",
        "@com_github_stretchr_testify//assert:go_default_library",
        "@com_github_stretchr_testify//require:go_default_library",
    ],
)
